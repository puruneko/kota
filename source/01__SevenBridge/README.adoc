= SevenBridge

== プロジェクト概要

* トランプのゲームの1つである「セブンブリッジ」をプログラムする
* プログラミング言語はC言語を使う
* インターフェースはコマンドラインとする
* 実行環境はwindowsとする
* 本プロジェクトは演習プロジェクトであり、明確なゴールや期日を定めない

== ゲーム概要

* トランプのカード52枚(ジョーカー無し)を使って行う
* 配られた手札をあるルール(後述:手札を切るルール)に従って場に出し、参加プレイヤーの内の誰かの手札が0枚になったらゲーム終了となる
* プレイヤーがカードを場に出す方法は3つある
+
. ターンの終わりに1枚カードを捨て札として捨てる。このとき、捨て札は前の捨て札の上に重ねられ、全てのプレイヤーからは捨て札の一番上のカードのみが見える状態となる。
. あるルール(後述:手札を切るルール)に合致した場合、手札を共通領域に新規に出すことができる。これを **メルド** といい、メルドされたカードが出される共通領域を **メルド領域** という。メルド領域に出されたカードは重ねて置かれること無く、全てのカードを見ることができる。また、メルド領域のカードはメルド毎にまとめられて置かれ、これを **メルドグループ** という。
. あるルール(後述:手札を切るルール)に合致した場合、手札をメルド領域に追加で出すことができる。これを **付け札** という。付け札はメルドグループ単位で行われ、複数のメルドグループに対して1枚のカードで付け札を行うことはできない。
+
* ゲーム終了時に持っている手札をあるルール(後述:点数計算のルール)に従って計算し、点数の少ない方から順位をつける


== ゲームの流れ

準備::
. 各プレイヤーにn枚のカードが配られる
. プレイヤーのカードを切る順番を決める

プレイ中::
. 前のプレイヤーが場にカードを捨てる
. 山札が0枚だったら、捨て札をすべて山札に移動しシャッフルする
. 捨てられたカードと自分の手札があるルール(後述:手札を切るルール)に合致していた場合、メルドが行える
. 山札からカードを引く
. 引いたカードと自分の手札があるルール(後述:手札を切るルール)に合致していた場合、メルドが行える(メルドは行えるだけ複数回行って良い。また、行わなくても良い。)
. 手札から場に1枚カードを捨てる

終了判定::
* プレイヤーの手札が0枚になったら終了
* 山札が2回0枚になったら終了

点数計算::
* 全てのプレイヤーの手札を、あるルール(後述:点数計算のルール)に従って点数計算する

ゲーム終了::
* 点数計算の結果をプレイヤーを紐づけた状態で昇順に並べ替え、それをゲームの順位とする


== 手札を切るルール

* ターンの最後に1枚カードを捨て札として場に出すことができる
* 自分の前のプレイヤーの捨て札に対し、下記条件のいずれかを満たす場合、メルドとして手札のカードをメルド領域に出すことができる。このイベントを行った場合、このターンは山札からカードを引くことができない。
+
. ポン：同じ数字が捨て札を含めて3枚以上ある場合、捨て札を含めてメルドを行うことができる。これを **ポン** という。
. チー：同じスートの数字が捨て札を含めて連番で3枚以上ある場合、捨て札を含めてメルドを行うことができる。これを **チー** という。
+
* 自分の手札に対し、下記条件のいずれかを満たす場合、メルドとして手札のカードをメルド領域に出すことができる
+
. 数字が **7** である場合、メルドを行うことができる。
. 同じ数字が3枚以上ある場合、メルドを行うことができる(ポンと同条件)。
. チー：同じスートの数字が連番で3枚以上ある場合、メルドを行うことができる(チーと同条件)。
+
* 自分の手札に対し、下記条件のいずれかを満たす場合、付け札として手札のカードをメルド領域に出すことができる。ただし、ポン・チーのいずれかを行ったターンについては付け札を行うことができない。
+
. 同じ数字で構成されるメルドグループに対し、手札に同じ数字がある場合、付け札としてメルドグループに追加でカードを出すことができる。
. 同じスートの連番で構成されるメルドグループに対し、下記条件のいずれかを満たす場合、付け札としてメルドグループに追加でカードを出すことができる。
+
.. メルドグループと同じスート、かつ最小の数字より1つ小さいカードが手札にある場合
.. メルドグループと同じ同じスート、かつ最大の数字より1つ大きいカードが手札にある場合
+
+


== 点数計算のルール
* 全ての手札に対し、下記ルールに従って点数計算を行い、その合計値をプレイヤーの点数とする
** 1〜9は、スートに関わらずその数字を点数とする
** 10〜13は、スートと数字に関わらず10とする

== フローチャート

[plantuml, flowchart]
----
title ゲームの概要フロー
start
:カード配る;
:順番決める;
while (プレイヤーNのカードが0枚ではない\nかつ\n山札が2回0毎になっていない) is (yes)
    if (山札が0枚) then (yes)
        :捨て札を山札に戻し\nシャッフル処理;
    else (no)
    endif
    if (ポン・チーできる\nかつ\nポン・チー行う) then (yes)
        :ポン・チー処理;
    else (no)
        :ドロー処理;
        while (メルドする\nまたは\n付け札する) is (yes)
            if (メルドできる\nかつ\nメルドする) then (yes)
                :メルド処理;
            else (no)
            endif
            if (付け札できる\nかつ\n付け札する) then (yes)
                :付け札処理;
            else (no)
            endif
        endwhile (no)
    endif
    :捨て札処理;
endwhile (no)
:点数計算;
:順位出力;
end
----
image::images\flowchart.png[]